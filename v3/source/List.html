<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">/* Copyright (c) 2010, Sage Software, Inc. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

<span id='argos-List'>/**
</span> * A List View is a view used to display a collection of items in an easy to skim list. The List View also has a
 * selection model built in for selecting rows from the list and may be used in a number of different manners.
 * @extends View
 * @alternateClassName List
 * @requires ErrorManager
 * @requires ScrollContainer
 * @requires SearchWidget
 * @requires TitleBar
 * @requires scene
 * @requires CustomizationSet
 */
define('argos/List', [
    'dojo/_base/declare',
    'dojo/_base/lang',
    'dojo/_base/array',
    'dojo/_base/connect',
    'dojo/_base/Deferred', /* todo: use `dojo/when` in 1.8 */
    'dojo/query',
    'dojo/NodeList-manipulate',
    'dojo/dom-attr',
    'dojo/dom-class',
    'dojo/dom-construct',
    'dojo/dom',
    'dojo/string',
    'dojo/topic',
    './View',
    './ErrorManager',
    './ScrollContainer',
    './SearchWidget',
    './TitleBar',
    'argos!scene',
    'argos!customizations'
], function(
    declare,
    lang,
    array,
    connect,
    Deferred,
    query,
    queryManipulate,
    domAttr,
    domClass,
    domConstruct,
    dom,
    string,
    topic,
    View,
    ErrorManager,
    ScrollContainer,
    SearchWidget,
    TitleBar,
    scene,
    customizations
) {

<span id='argos-SelectionModel'>    /**
</span>     * SelectionModel provides a simple in-memory store for data that fires events
     * when a item is selected (added) or deselected (removed)
     * @alternateClassName SelectionModel
     */
    var SelectionModel = declare('argos.SelectionModel', null, {
<span id='argos-SelectionModel-property-count'>        /**
</span>         * @property {Number}
         * Number of selections
         */
        count: 0,
<span id='argos-SelectionModel-property-selections'>        /**
</span>         * @property {Object}
         * Collection of selections where the key is the selections key
         */
        selections: null,
<span id='argos-SelectionModel-cfg-clearAsDeselect'>        /**
</span>         * @cfg {Boolean}
         * Flag that determines how to clear:
         *
         * True: Deselect is called on every item, firing onDeselect for each and firing onClear at the end
         *
         * False: Collection is immediately wiped and only onClear is fired
         *
         */
        clearAsDeselect: true,
<span id='argos-SelectionModel-property-_fireEvents'>        /**
</span>         * @property {Boolean}
         * Flag that control the firing of action events: onSelect, onDeselect, onClear
         */
        _fireEvents: true,
<span id='argos-SelectionModel-method-constructor'>        /**
</span>         * Initializes the selections to be empty and mixes the passed object overriding any default properties.
         * @param {Object} options The object to be mixed in.
         */
        constructor: function(options) {
            this.selections = {};
            
            lang.mixin(this, options);
        },
<span id='argos-SelectionModel-method-suspendEvents'>        /**
</span>         * Prevents the firing of action events: onSelect, onDeselect, onClear
         */
        suspendEvents: function() {
            this._fireEvents = false;
        },
<span id='argos-SelectionModel-method-resumeEvents'>        /**
</span>         * Enables the firing of action events:  onSelect, onDeselect, onClear
         */
        resumeEvents: function() {
            this._fireEvents = true;
        },
<span id='argos-SelectionModel-method-onSelect'>        /**
</span>         * Event that happens when an item is selected/added. A View should `connect` this function to a handler.
         * @param {String} key Unique identifier string
         * @param {Object} data The item stored
         * @param tag
         * @param self
         */
        onSelect: function(key, data, tag, self) {
        },
<span id='argos-SelectionModel-method-onDeselect'>        /**
</span>         * Event that happens when an item is deselected/removed. A View should `connect` this function to a handler.
         * @param {String} key Unique identifier string
         * @param {Object} data The item removed
         * @param tag
         * @param self
         */
        onDeselect: function(key, data, tag, self) {
        },
<span id='argos-SelectionModel-method-onClear'>        /**
</span>         * Event that happens when the store is cleared
         * @param self
         */
        onClear: function(self) {
        },
<span id='argos-SelectionModel-method-select'>        /**
</span>         * Adds an item to the `selections` if it is not already stored.
         * @param {String} key Unique identifier string
         * @param {Object} data The item being selected
         * @param tag
         */
        select: function(key, data, tag) {
            if (!this.selections.hasOwnProperty(key))
            {
                this.selections[key] = {data: data, tag: tag};
                this.count++;
                if (this._fireEvents) this.onSelect(key, data, tag, this);
            }
        },
<span id='argos-SelectionModel-method-toggle'>        /**
</span>         * Adds an item to the `selections` if it is not already stored, if it is
         * stored, then it deselects (removes) the item.
         * @param {String} key Unique identifier string
         * @param {Object} data The item being selected
         * @param tag
         */
        toggle: function(key, data, tag) {
            if (this.isSelected(key))
                this.deselect(key);
            else
                this.select(key, data, tag);
        },
<span id='argos-SelectionModel-method-deselect'>        /**
</span>         * Removes an item from the store
         * @param {String} key Unique identifier string that was given when the item was added
         */
        deselect: function(key) {
            if (this.selections.hasOwnProperty(key))
            {
                var selection = this.selections[key];

                delete this.selections[key];
                this.count--;

                if (this._fireEvents)
                    this.onDeselect(key, selection.data, selection.tag, this);
            }
        },
<span id='argos-SelectionModel-method-clear'>        /**
</span>         * Removes all items from the store
         */
        clear: function() {
            if (this.clearAsDeselect)
            {
                for (var key in this.selections) this.deselect(key);
            }
            else
            {
                this.selections = {};
                this.count = 0;
            }

            if (this._fireEvents) this.onClear(this);
        },
<span id='argos-SelectionModel-method-isSelected'>        /**
</span>         * Determines if the given key is in the selections collection.
         * @param {String} key Unique identifier string that was given when the item was added
         * @return {Boolean} True if the item is in the store.
         */
        isSelected: function(key) {
            return !!this.selections[key];
        },
<span id='argos-SelectionModel-method-getSelectionCount'>        /**
</span>         * Returns the number of items in the store
         * @return {Number} Current count of items
         */
        getSelectionCount: function() {
            return this.count;
        },
<span id='argos-SelectionModel-method-getSelections'>        /**
</span>         * Returns all items in the store
         * @return {Object} The entire selection collection
         */
        getSelections: function() {
            return this.selections;
        },
<span id='argos-SelectionModel-method-getSelectedKeys'>        /**
</span>         * Returns a list of unique identifier keys used in the selection collection
         * @return {String[]} All keys in the store
         */
        getSelectedKeys: function() {
            var keys = [];
            for (var key in this.selections)
                if (this.selections.hasOwnProperty(key))
                    keys.push(key);
            return keys;
        }
    });

<span id='argos-ConfigurableSelectionModel'>    /**
</span>     * The ConfigurableSelectionModel adds the logic to the SelectionModel to only have one item selected at a time via the `singleSelection` flag.
     * @alternateClassName ConfigurableSelectionModel
     * @extends SelectionModel
     */
    var ConfigurableSelectionModel = declare('argos.ConfigurableSelectionModel', [SelectionModel], {
<span id='argos-ConfigurableSelectionModel-cfg-singleSelection'>        /**
</span>         * @cfg {Boolean}
         * Flag that controls if only one item is selectable at a time. Meaning if this is true
         * then when a selection is made it first {@link SelectionModel#clear clears} the store.
         */
        singleSelection: false,
<span id='argos-ConfigurableSelectionModel-method-useSingleSelection'>        /**
</span>         * This function is called in Lists {@link List#beforeTransitionTo beforeTransitionTo} and
         * it is always passed the Lists navigation options `singleSelect`.
         *
         * It then sets the flag `singleSelection` to the value if the passed value.
         *
         * @param {Boolean} val The state that `singleSelection` should be in.
         */
        useSingleSelection: function(val) {
            if (this.singleSelection != !!val) //false != undefined = true, false != !!undefined = false
            {
                this.singleSelection = val;
                this.clear();
            }
        },
<span id='argos-ConfigurableSelectionModel-method-select'>        /**
</span>         * Extends the base {@link SelectionModel#select select} by first clearing out the entire
         * store if `singleSelection` is true and there are items already in the store.
         * @param {String} key Unique identifier string
         * @param {Object} data The item being selected
         * @param tag
         */
        select: function(key, data, tag) {
            if (this.singleSelection)
            {
                if (!this.isSelected(key) || (this.count &gt;= 1)) this.clear();
            }

            this.inherited(arguments);
        }
    });

    return declare('argos.List', [View], {
<span id='argos-List-property-events'>        events: {
</span>            'click': true
        },
<span id='argos-List-cfg-components'>        components: [
</span>            {name: 'search', type: SearchWidget, attachEvent: 'onQuery:_onSearchQuery,onClear:_onSearchClear'},
            {name: 'fix', content: '&lt;a href=&quot;#&quot; class=&quot;android-6059-fix&quot;&gt;fix for android issue #6059&lt;/a&gt;'},
            {name: 'scroller', type: ScrollContainer, subscribeEvent: 'onContentChange:onContentChange', components: [
                {name: 'scroll', tag: 'div', components: [
                    {name: 'empty', tag: 'div', attrs: {'class': 'list-empty'}, attachPoint: 'emptySelectionNode', components: [
                        {name: 'emptyButton', content: Simplate.make('&lt;button class=&quot;button&quot; data-action=&quot;emptySelection&quot;&gt;&lt;span&gt;{%: $.emptySelectionText %}&lt;/span&gt;&lt;/button&gt;')}
                    ]},
                    {name: 'content', tag: 'ul', attrs: {'class': 'list-content'}, attachPoint: 'contentNode'},
                    {name: 'more', tag: 'div', attrs: {'class': 'list-more'}, components: [
                        {name: 'moreRemaining', tag: 'span', attrs: {'class': 'list-remaining'}, attachPoint: 'remainingContentNode'},
                        {name: 'moreButton', content: Simplate.make('&lt;button class=&quot;button&quot; data-action=&quot;more&quot;&gt;&lt;span&gt;{%: $.moreText %}&lt;/span&gt;&lt;/button&gt;')}
                    ]},
                    {name: 'list-actions', tag: 'li', attrs: {'class': 'actions-row'}, attachPoint: 'actionsNode'}
                ]}
            ]}
        ],
<span id='argos-List-property-baseClass'>        baseClass: 'view list has-search-header',
</span><span id='argos-List-property-contentNode'>        /**
</span>         * @property {HTMLElement}
         * Attach point for the main view content
         */
        contentNode: null,
<span id='argos-List-property-remainingContentNode'>        /**
</span>         * @property {HTMLElement}
         * Attach point for the remaining items content
         */
        remainingContentNode: null,
<span id='argos-List-property-emptySelectionNode'>        /**
</span>         * @property {HTMLElement}
         * Attach point for the empty, or no selection, container
         */
        emptySelectionNode: null,
<span id='argos-List-property-remainingNode'>        /**
</span>         * @property {HTMLElement}
         * Attach point for the remaining items container
         */
        remainingNode: null,
<span id='argos-List-property-moreNode'>        /**
</span>         * @property {HTMLElement}
         * Attach point for the request more items container
         */
        moreNode: null,
<span id='argos-List-property-_setListContentAttr'>        _setListContentAttr: {node: 'contentNode', type: 'innerHTML'},
</span><span id='argos-List-property-_setRemainingContentAttr'>        _setRemainingContentAttr: {node: 'remainingContentNode', type: 'innerHTML'},
</span><span id='argos-List-property-loadingTemplate'>        /**
</span>         * @property {Simplate}
         * The template used to render the loading message when the view is requesting more data.
         *
         * The default template uses the following properties:
         *
         *      name                description
         *      ----------------------------------------------------------------
         *      loadingText         The text to display while loading.
         */
        loadingTemplate: new Simplate([
            '&lt;li class=&quot;loading-indicator&quot;&gt;&lt;div&gt;{%: $.loadingText %}&lt;/div&gt;&lt;/li&gt;'
        ]),
<span id='argos-List-property-rowTemplate'>        /**
</span>         * @property {Simplate}
         * The template used to render a row in the view.  This template includes {@link #itemTemplate}.
         */
        rowTemplate: new Simplate([
            '&lt;li data-action=&quot;activateEntry&quot; data-key=&quot;{%= $.$key %}&quot; data-descriptor=&quot;{%: $.$descriptor %}&quot;&gt;',
            '&lt;button data-action=&quot;selectEntry&quot; class=&quot;list-item-selector button&quot;&gt;',
            '&lt;img src=&quot;{%= $$.icon || $$.selectIcon %}&quot; class=&quot;icon&quot; /&gt;',
            '&lt;/button&gt;',
            '&lt;div class=&quot;list-item-content&quot;&gt;{%! $$.itemTemplate %}&lt;/div&gt;',
            '&lt;/li&gt;'
        ]),
<span id='argos-List-cfg-itemTemplate'>        /**
</span>         * @cfg {Simplate}
         * The template used to render the content of a row.  This template is not directly rendered, but is
         * included in {@link #rowTemplate}.
         *
         * This property should be overridden in the derived class.
         * @template
         */
        itemTemplate: new Simplate([
            '&lt;h3&gt;{%: $.$descriptor %}&lt;/h3&gt;',
            '&lt;h4&gt;{%: $.$key %}&lt;/h4&gt;'
        ]),
<span id='argos-List-property-noDataTemplate'>        /**
</span>         * @property {Simplate}
         * The template used to render a message if there is no data available.
         * The default template uses the following properties:
         *
         *      name                description
         *      ----------------------------------------------------------------
         *      noDataText          The text to display if there is no data.
         */
        noDataTemplate: new Simplate([
            '&lt;li class=&quot;no-data&quot;&gt;',
            '&lt;h3&gt;{%= $.noDataText %}&lt;/h3&gt;',
            '&lt;/li&gt;'
        ]),
<span id='argos-List-property-listActionItemTemplate'>        /**
</span>         * @property {Simplate}
         * The template used to render a list action item.
         * The default template uses the following properties:
         *
         *      name                description
         *      ----------------------------------------------------------------
         *      actionIndex         The correlating index number of the action collection
         *      title               Text used for ARIA-labeling
         *      icon                Relative path to the icon to use
         *      id                  Unique name of action, also used for alt image text
         *      label               Text added below the icon
         */
        listActionItemTemplate: new Simplate([
            '&lt;button data-action=&quot;invokeActionItem&quot; data-id=&quot;{%= $.actionIndex %}&quot; aria-label=&quot;{%: $.title || $.id %}&quot;&gt;',
            '&lt;img src=&quot;{%= $.icon %}&quot; alt=&quot;{%= $.id %}&quot; /&gt;',
            '&lt;label&gt;{%: $.label %}&lt;/label&gt;',
            '&lt;/button&gt;'
        ]),
<span id='argos-List-cfg-id'>        /**
</span>         * @cfg {String} id
         * The id for the view, and it's main DOM element.
         */
        id: 'generic_list',
<span id='argos-List-property-tier'>        tier: 0,
</span><span id='argos-List-property-store'>        store: null,
</span><span id='argos-List-cfg-resourceKind'>        /**
</span>         * @cfg {String}
         * The SData resource kind the view is responsible for.  This will be used as the default resource kind
         * for all SData requests.
         */
        resourceKind: null,
<span id='argos-List-cfg-querySelect'>        /**
</span>         * @cfg {String[]}
         * A list of fields to be selected in an SData request.
         */
        querySelect: null,
<span id='argos-List-cfg-queryInclude'>        /**
</span>         * @cfg {String[]}
         * Optional list of child properties to be included in an SData request.
         */
        queryInclude: null,
<span id='argos-List-cfg-queryOrderBy'>        /**
</span>         * @cfg {String}
         * The default order by expression for an SData request.
         */
        queryOrderBy: null,
<span id='argos-List-cfg-queryWhere'>        /**
</span>         * @cfg {String/Function}
         * The default where expression for an SData request.
         */
        queryWhere: null,
<span id='argos-List-cfg-resourceProperty'>        /**
</span>         * @cfg {String/Function}
         * The default resource property for an SData request.
         */
        resourceProperty: null,
<span id='argos-List-cfg-resourcePredicate'>        /**
</span>         * @cfg {String/Function}
         * The default resource predicate for an SData request.
         */
        resourcePredicate: null,
<span id='argos-List-cfg-pageSize'>        /**
</span>         * @cfg {Number}
         * The number of items to request per SData payload.
         */
        pageSize: 20,
<span id='argos-List-cfg-enableSearch'>        /**
</span>         * @cfg {Boolean}
         * Controls the addition of a search widget.
         */
        enableSearch: true,
<span id='argos-List-cfg-hideSearch'>        /**
</span>         * @cfg {Boolean}
         * Controls the visibility of the search widget.
         */
        hideSearch: false,
<span id='argos-List-cfg-enableActions'>        /**
</span>         * @cfg {Boolean}
         * Flag that determines if the list actions panel should be in use.
         */
        enableActions: false,
<span id='argos-List-cfg-allowSelection'>        /**
</span>         * @cfg {Boolean}
         * True to allow selections via the SelectionModel in the view.
         */
        allowSelection: false,
<span id='argos-List-cfg-autoClearSelection'>        /**
</span>         * @cfg {Boolean}
         * True to clear the selection model when the view is shown.
         */
        autoClearSelection: true,
<span id='argos-List-cfg-detailView'>        /**
</span>         * @cfg {String}
         * The id of the detail view to show when a row is clicked.
         */
        detailView: null,
<span id='argos-List-cfg-editView'>        /**
</span>         * @cfg {String}
         * The view id to show if there is no `insertView` specified, when
         * the {@link #navigateToInsertView navigateToInsertView} action is invoked.
         */
        editView: null,
<span id='argos-List-cfg-insertView'>        /**
</span>         * @cfg {String}
         * The view id to show when the {@link #navigateToInsertView} action is invoked.
         */
        insertView: null,
<span id='argos-List-cfg-contextView'>        /**
</span>         * @cfg {String}
         * The view id to show when the {@link #navigateToContextView navigateToContextView} action is invoked.
         */
        contextView: false,
<span id='argos-List-property-hashTags'>        /**
</span>         * The built hash tag layout.
         */
        hashTags: null,
<span id='argos-List-cfg-hashTagQueries'>        /**
</span>         * @cfg {Object}
         * A dictionary of hash tag search queries.  The key is the hash tag, without the symbol, and the value is
         * either a query string, or a function that returns a query string.
         */
        hashTagQueries: null,
<span id='argos-List-property-customSearchRE'>        /**
</span>         * The regular expression used to determine if a search query is a custom search expression.  A custom search
         * expression is not processed, and directly passed to SData.
         * @type {Object}
         */
        customSearchRE: /^#!/,
<span id='argos-List-property-hashTagSearchRE'>        /**
</span>         * The regular expression used to determine if a search query is a hash tag search.
         * @type {Object}
         */
        hashTagSearchRE: /(?:#|;|,|\.)(\w+)/g,
<span id='argos-List-property-moreText'>        /**
</span>         * @property {String}
         * The text displayed in the more button.
         */
        moreText: 'Retrieve More Records',
<span id='argos-List-property-emptySelectionText'>        /**
</span>         * @property {String}
         * The text displayed in the emptySelection button.
         */
        emptySelectionText: 'None',
<span id='argos-List-cfg-titleText'>        /**
</span>         * @cfg {String}
         * The text displayed as the default title.
         */
        titleText: 'List',
<span id='argos-List-property-remainingText'>        /**
</span>         * @property {String}
         * The format string for the text displayed for the remaining record count.  This is used in a {@link String#format} call.
         */
        remainingText: '${0} records remaining',
<span id='argos-List-property-cancelText'>        /**
</span>         * @property {String}
         * The text displayed on the cancel button.
         * @deprecated
         */
        cancelText: 'Cancel',
<span id='argos-List-property-insertText'>        /**
</span>         * @property {String}
         * The text displayed on the insert button.
         * @deprecated
         */
        insertText: 'New',
<span id='argos-List-property-noDataText'>        /**
</span>         * @property {String}
         * The text displayed when no records are available.
         */
        noDataText: 'no records',
<span id='argos-List-property-loadingText'>        /**
</span>         * @property {String}
         * The text displayed when data is being requested.
         */
        loadingText: 'Loading...',
<span id='argos-List-property-searchText'>        searchText: 'Search',
</span><span id='argos-List-property-requestErrorText'>        /**
</span>         * @property {String}
         * The text displayed when a data request fails.
         */
        requestErrorText: 'A server error occurred while requesting data.',
<span id='argos-List-property-items'>        items: {},
</span><span id='argos-List-property-customizationSet'>        /**
</span>         * @property {String}
         * The customization identifier for this class. When a customization is registered it is passed
         * a path/identifier which is then matched to this property.
         */
        customizationSet: 'list',
<span id='argos-List-property-actionsNode'>        actionsNode: null,
</span><span id='argos-List-property-_selectionModel'>        /**
</span>         * @property {Object}
         * The selection model for the view
         */
        _selectionModel: null,
<span id='argos-List-property-_selectionConnects'>        /**
</span>         * @property {Object}
         * The selection model event connections
         */
        _selectionConnects: null,
<span id='argos-List-method-_setSelectionModelAttr'>        /**
</span>         * Setter method for the selection model, also binds the various selection model select events
         * to the respective List event handler for each.
         * @param {SelectionModel} selectionModel The selection model instance to save to the view
         */
        _setSelectionModelAttr: function(selectionModel) {
            if (this._selectionConnects) array.forEach(this._selectionConnects, this.disconnect, this);

            this._selectionModel = selectionModel;
            this._selectionConnects = [];

            if (this._selectionModel)
            {
                this._selectionConnects.push(
                    this.connect(this._selectionModel, 'onSelect', this._onSelectionModelSelect),
                    this.connect(this._selectionModel, 'onDeselect', this._onSelectionModelDeselect),
                    this.connect(this._selectionModel, 'onClear', this._onSelectionModelClear)
                );
            }
        },
<span id='argos-List-method-_getSelectionModelAttr'>        /**
</span>         * Getter method for the selection model
         * @return {SelectionModel}
         */
        _getSelectionModelAttr: function() {
            return this._selectionModel;
        },
<span id='argos-List-method-onStartup'>        /**
</span>         * Setups the View including: selection model, search widget, bind to the global refresh publish event, and
         * create actions.
         */
        onStartup: function() {
            this.inherited(arguments);

            if (this._selectionModel == null)
                this.set('selectionModel', new ConfigurableSelectionModel());

            this.subscribe('/app/refresh', this._onRefresh);

            domClass.toggle(this.domNode, 'has-search-header', this.hideSearch);

            if (this.searchText &amp;&amp; this.enableSearch)
                this.$.search.setLabel(this.searchText);

            var customizationSet = customizations();
            this.createActions(customizationSet.apply(customizationSet.toPath(this.customizationSet, 'actions', this.id), this.createActionLayout()));

            this.clear(true);
        },
<span id='argos-List-method-onDestroy'>        /**
</span>         * Destroys the search widget and store, and disconnect selection events before destroying the view.
         */
        onDestroy: function() {
            this.inherited(arguments);

            delete this.store;

            if (this._selectionConnects)
            {
                array.forEach(this._selectionConnects, this.disconnect, this);

                delete this._selectionConnects;
                delete this._selectionModel;
            }
        },
<span id='argos-List-method-_getStoreAttr'>        _getStoreAttr: function() {
</span>            return this.store || (this.store = this.createStore());
        },
<span id='argos-List-method-createToolLayout'>        /**
</span>         * Sets and returns the toolbar item layout definition, this method should be overriden in the view
         * so that you may define the views toolbar items.
         * @return {Object} this.tools
         * @template
         */
        createToolLayout: function() {
            return this.tools || (this.tools = {
                'top': [{
                    id: 'new',
                    action: 'navigateToInsertView',
                    security: App.getViewSecurity(this.insertView, 'insert')
                }]
            });
        },
<span id='argos-List-method-createActionLayout'>        /**
</span>         * Sets and returns the list-action actions layout definition, this method should be overriden in the view
         * so that you may define the action items for that view.
         * @return {Object} this.actions
         * @template
         */
        createActionLayout: function() {
            return this.actions || {};
        },
<span id='argos-List-method-createActions'>        /**
</span>         * Creates the action bar and adds it to the DOM. Note that it replaces `this.actions` with the passed
         * param as the passed param should be the result of the customization mixin and `this.actions` needs to be the
         * final actions state.
         * @param {Object[]} actions
         */
        createActions: function(actions) {
            for (var i = 0; i &lt; actions.length; i++)
            {
                var action = actions[i],
                    options = {
                        actionIndex: i,
                        hasAccess: (action.security &amp;&amp; App.hasAccessTo(this.expandExpression(action.security))) || true
                    },
                    actionTemplate = action.template || this.listActionItemTemplate;

                lang.mixin(action, options);
                domConstruct.place(actionTemplate.apply(action, action.id), this.actionsNode, 'last');
            }

            this.actions = actions;
        },
<span id='argos-List-method-invokeActionItem'>        /**
</span>         * This is the data-action handler for list-actions, it will locate the action instance viw the data-id attribute
         * and invoke either the `fn` with `scope` or the named `action` on the current view.
         *
         * The resulting function being called will be passed not only the action item definition but also
         * the first (only) selection from the lists selection model.
         *
         * @param {Object} parameters Collection of data- attributes already gathered from the node
         * @param {Event} evt The click/tap event
         * @param {HTMLElement} node The node that invoked the action
         */
        invokeActionItem: function(evt, node) {
            var index = domAttr.get(node, 'data-id'),
                action = this.actions[index],
                selectedItems = this.get('selectionModel').getSelections(),
                selection = null;

            if (!action.isEnabled) return;

            for (var key in selectedItems)
            {
                selection = selectedItems[key];
                break;
            }

            if (action['fn'])
                action['fn'].call(action['scope'] || this, action, selection);
            else if (action['action'] &amp;&amp; this[action['action']])
                    this[action['action']].call(action['scope'] || this, action, selection);
        },
<span id='argos-List-method-checkActionState'>        /**
</span>         * Called when showing the action bar for a newly selected row, it sets the disabled state for each action
         * item using the currently selected row as context by passing the action instance the selected row to the
         * action items `enabled` property.
         */
        checkActionState: function() {
            var selectedItems = this.get('selectionModel').getSelections(),
                selection = null;

            for (var key in selectedItems)
            {
                selection = selectedItems[key];
                break;
            }

            for (var i = 0; i &lt; this.actions.length; i++)
            {
                var action = this.actions[i];

                action.isEnabled = (typeof action['enabled'] === 'undefined')
                    ? true
                    : this.expandExpression(action['enabled'], action, selection);

                if (!action.hasAccess)
                    action.isEnabled = false;

                domClass.toggle(this.actionsNode.childNodes[i], 'toolButton-disabled', !action.isEnabled);
            }

        },
<span id='argos-List-method-showActionPanel'>        /**
</span>         * Handler for showing the list-action panel/bar - it needs to do several things:
         *
         * 1. Check each item for context-enabledment
         * 1. Move the action panel to the current row and show it
         * 1. Adjust the scrolling if needed (if selected row is at bottom of screen, the action-bar shows off screen
         * which is bad)
         *
         * @param {HTMLElement} rowNode The currently selected row node
         */
        showActionPanel: function(rowNode) {
            this.checkActionState();

            domClass.add(rowNode, 'list-action-selected');
            domConstruct.place(this.actionsNode, rowNode, 'after');

            if (this.actionsNode.offsetTop + this.actionsNode.clientHeight + 48 &gt; document.documentElement.clientHeight)
                this.actionsNode.scrollIntoView(false);
        },
<span id='argos-List-method-setSource'>        /**
</span>         * Sets the `this.options.source` to passed param after adding the views resourceKind. This function is used so
         * that when the next view queries the navigation context we can include the passed param as a data point.
         *
         * @param {Object} source The object to set as the options.source.
         */
        setSource: function(source) {
            lang.mixin(source, {
                resourceKind: this.resourceKind
            });

            this.options.source = source;
        },
<span id='argos-List-method-hideActionPanel'>        /**
</span>         * Hides the passed list-action row/panel by removing the selected styling
         * @param {HTMLElement} rowNode The currently selected row.
         */
        hideActionPanel: function(rowNode) {
            domClass.remove(rowNode, 'list-action-selected');
        },
<span id='argos-List-method-isNavigationDisabled'>        /**
</span>         * Determines if the view is a navigatible view or a selection view by returning `this.selectionOnly` or the
         * navigation `this.options.selectionOnly`.
         * @return {Boolean}
         */
        isNavigationDisabled: function() {
            return ((this.options &amp;&amp; this.options.selectionOnly) || (this.selectionOnly));
        },
<span id='argos-List-method-isSelectionDisabled'>        /**
</span>         * Determines if the selections are disabled by checking the `allowSelection` and `enableActions`
         * @return {Boolean}
         */
        isSelectionDisabled: function() {
            return !((this.options &amp;&amp; this.options.selectionOnly) || this.enableActions || this.allowSelection);
        },
<span id='argos-List-method-_onSelectionModelSelect'>        /**
</span>         * Handler for when the selection model adds an item. Adds the selected state to the row or shows the list
         * actions panel.
         * @param {String} key The extracted key from the selected row.
         * @param {Object} data The actual row's matching data point
         * @param {String/HTMLElement} tag An indentifier, may be the actual row node or some other id.
         */
        _onSelectionModelSelect: function(key, data, tag) {
            var node = dom.byId(tag) || query('li[data-key=&quot;'+key+'&quot;]', this.domNode)[0];
            if (!node) return;

            if (this.enableActions)
            {
                this.showActionPanel(node);
                return;
            }

            domClass.add(node, 'list-item-selected');
        },
<span id='argos-List-method-_onSelectionModelDeselect'>        /**
</span>         * Handler for when the selection model removes an item. Removes the selected state to the row or hides the list
         * actions panel.
         * @param {String} key The extracted key from the de-selected row.
         * @param {Object} data The actual row's matching data point
         * @param {String/HTMLElement} tag An indentifier, may be the actual row node or some other id.
         */
        _onSelectionModelDeselect: function(key, data, tag) {
            var node = dom.byId(tag) || query('li[data-key=&quot;'+key+'&quot;]', this.domNode)[0];
            if (!node) return;

            if (this.enableActions)
            {
                this.hideActionPanel(node);
                return;
            }

            domClass.remove(node, 'list-item-selected');
        },
<span id='argos-List-method-_onSelectionModelClear'>        /**
</span>         * Handler for when the selection model clears the selections.
         */
        _onSelectionModelClear: function() {
        },
<span id='argos-List-method-_loadPreviousSelections'>        /**
</span>         * Attempts to activate entries passed in `this.options.previousSelections` where previousSelections is an array
         * of data-keys or data-descriptors to search the list rows for.
         */
        _loadPreviousSelections: function() {
            var previousSelections = this.options &amp;&amp; this.options.previousSelections;
            if (previousSelections)
            {
                for (var i = 0; i &lt; previousSelections.length; i++)
                {
                    var row = query((string.substitute('[data-key=&quot;${0}&quot;], [data-descriptor=&quot;${0}&quot;]', [previousSelections[i]])), this.contentNode)[0];

                    if (row)
                        this.selectEntry(null, row);
                }
            }
        },
<span id='argos-List-method-_onRefresh'>        /**
</span>         * Handler for the global `/app/refresh` event. Sets `refreshRequired` to true if the resourceKind matches.
         * @param {Object} options The object published by the event.
         */
        _onRefresh: function(options) {
            if (this.resourceKind &amp;&amp; options.resourceKind === this.resourceKind)
            {
                this.refreshRequired = true;
            }
        },
<span id='argos-List-method-selectEntry'>        /**
</span>         * Handler for the select or action node data-action. Finds the nearest node with the data-key attribute and
         * toggles it in the views selection model.
         *
         * If singleSelectAction is defined, invoke the singleSelectionAction.
         *
         * @param {Event} evt The click/tap event.
         * @param {HTMLElement} node The element that initiated the event.
         */
        selectEntry: function(evt, node) {
            var row = query(node).closest('[data-key]')[0],
                key = row ? row.getAttribute('data-key') : false;

            if (this._selectionModel &amp;&amp; key)
                this._selectionModel.toggle(key, this.items[key], row);

            if (this.options.singleSelect &amp;&amp; this.options.singleSelectAction &amp;&amp; !this.enableActions)
                this.invokeSingleSelectAction();
        },
<span id='argos-List-method-activateEntry'>        /**
</span>         * Handler for each row.
         *
         * If a selection model is defined and navigation is disabled then toggle the entry/row
         * in the model and if singleSelectionAction is true invoke the singleSelectAction.
         *
         * Else navigate to the detail view for the extracted data-key.
         *
         * @param {Event} evt The click/tap event.
         * @param {HTMLElement} node The element that initiated the event.
         */
        activateEntry: function(evt, node) {
            var descriptor = node &amp;&amp; node.getAttribute('data-descriptor'),
                key = node &amp;&amp; node.getAttribute('data-key');
            if (key)
            {
                if (this._selectionModel &amp;&amp; this.isNavigationDisabled())
                {
                    this._selectionModel.toggle(key, this.items[key] || descriptor, node);

                    if (this.options.singleSelect &amp;&amp; this.options.singleSelectAction)
                    {
                        this.invokeSingleSelectAction();
                    }
                }
                else
                {
                    this.navigateToDetailView(key, descriptor);
                }
            }
        },
<span id='argos-List-method-invokeSingleSelectAction'>        /**
</span>         * Invokes the corresponding top toolbar tool using `this.options.singleSelectAction` as the name.
         * If autoClearSelection is true, clear the selection model.
         */
        invokeSingleSelectAction: function() {
            topic.publish('/app/toolbar/invoke', this.options.singleSelectAction);

            if (this.autoClearSelection)
                this._selectionModel.clear();
        },
<span id='argos-List-method-_getHashTagsAttr'>        _getHashTagsAttr: function() {
</span>            var customizationSet = customizations();
            return customizationSet.apply(customizationSet.toPath(this.customizationSet, 'hashTagQueries', this.id), this.createHashTagQueryLayout());
        },
<span id='argos-List-method-_setHashTagsAttr'>        _setHashTagsAttr: function(value) {
</span>            this.hashTags = value;
        },
<span id='argos-List-method-createHashTagQueryLayout'>        createHashTagQueryLayout: function() {
</span>            if (this.hashTags) return this.hashTags;

            var layout = [];

            for (var name in this.hashTagQueries)
            {
                layout.push({
                    'key': name,
                    'tag': (this.hashTagQueriesText &amp;&amp; this.hashTagQueriesText[name]) || name,
                    'query': this.hashTagQueries[name]
                });
            }

            return (this.hashTags = layout);
        },
<span id='argos-List-method-formatSearchQuery'>        /**
</span>         * Called to transform a textual query into an SData query compatible search expression.
         *
         * Views should override this function to provide their own formatting tailored to their entity.
         *
         * @param {String} searchQuery User inputted text from the search widget.
         * @return {String/Boolean} An SData query compatible search expression.
         * @template
         */
        formatSearchQuery: function(query) {
            return false;
        },
<span id='argos-List-method-formatHashTagQuery'>        formatHashTagQuery: function(query) {
</span>            return false;
        },
<span id='argos-List-method-_onSearchQuery'>        /**
</span>         * Handler for the search widgets search.
         *
         * Prepares the view by clearing it and setting `this.query` to the given search expression. Then calls
         * {@link #requestData requestData} which start the request process.
         *
         * @param {String} expression String expression as returned from the search widget
         */
        _onSearchQuery: function(query) {
            if (query)
            {
                if (this.hashTagSearchRE.test(query))
                {
                    this.query = this.formatHashTagQuery(query);
                }
                else
                {
                    this.query = this.formatSearchQuery(query);
                }
            }
            else
            {
                this.query = false;
            }

            this.clear(false);
            this._requestData();
        },
<span id='argos-List-method-_onSearchClear'>        _onSearchClear: function() {
</span>
        },
<span id='argos-List-method-createStore'>        createStore: function() {
</span>            return null;
        },
<span id='argos-List-method-navigateToRelatedView'>        /**
</span>         * Helper method for list actions. Takes a view id, data point and where format string, sets the nav options
         * `where` to the formatted expression using the data point and shows the given view id with that option.
         * @param {Object} action Action instance, not used.
         * @param {Object} selection Data entry for the selection.
         * @param {String} viewId View id to be shown
         * @param {String} whereQueryFmt Where expression format string to be passed. `${0}` will be the `$key`
         * property of the passed selection data.
         */
        navigateToRelatedView:  function(action, selection, viewId, whereQueryFmt) {
            var options = {};

            if (whereQueryFmt &amp;&amp; selection)
                options['where'] = string.substitute(whereQueryFmt, [selection.data['$key']]);

            this.setSource({
                entry: selection.data,
                descriptor: selection.data['$descriptor'],
                key: selection.data['$key']
            });

            scene().showView(viewId, options);
        },
<span id='argos-List-method-navigateToDetailView'>        /**
</span>         * Navigates to the defined `this.detailView` passing the params as navigation options.
         * @param {String} key Key of the entry to be shown in detail
         * @param {String} descriptor Description of the entry, will be used as the top toolbar title text.
         */
        navigateToDetailView: function(key, descriptor) {
            scene().showView(this.detailView, {
                descriptor: descriptor,
                key: key
            });
        },
<span id='argos-List-method-navigateToEditView'>        /**
</span>         * Helper method for list-actions. Navigates to the defined `this.editView` passing the given selections `$key`
         * property in the navigation options (which is then requested and result used as default data).
         * @param {Object} action Action instance, not used.
         * @param {Object} selection Data entry for the selection.
         */
        navigateToEditView: function(action, selection) {
            scene().showView(this.editView || this.insertView, {
                key: selection.data['$key']
            });
        },
<span id='argos-List-method-navigateToInsertView'>        /**
</span>         * Navigates to the defined `this.insertView`, or `this.editView` passing the current views id as the `returnTo`
         * option and setting `insert` to true.
         */
        navigateToInsertView: function() {
            scene().showView(this.insertView || this.editView, {
                returnTo: this.id,
                insert: true
            });
        },
<span id='argos-List-method-onContentChange'>        onContentChange: function() {
</span>        },
<span id='argos-List-method-_processItem'>        _processItem: function(item) {
</span>            return item;
        },
<span id='argos-List-method-_processData'>        /**
</span>         * Processes the items array from the store and renders out the feed entries.
         *
         * Saves each entry to the `this.items` collection using the entries `$key` as the key.
         *
         * @param {Object[]} items Items to process
         */
        _processData: function(items) {
            var store = this.get('store'),
                count = items.length;
            if (count &gt; 0)
            {
                var output = [];

                for (var i = 0; i &lt; count; i++)
                {
                    var item = this._processItem(items[i]);

                    this.items[store.getIdentity(item)] = item;

                    output.push(this.rowTemplate.apply(item, this));
                }

                if (output.length &gt; 0) domConstruct.place(output.join(''), this.contentNode, 'last');
            }
        },
<span id='argos-List-method-_onQueryComplete'>        _onQueryComplete: function(queryResults, items) {
</span>            var start = this.position;

            Deferred.when(queryResults.total, lang.hitch(this, this._onQueryTotal));

            /* todo: move to a more appropriate location */
            if (this.options &amp;&amp; this.options.allowEmptySelection) domClass.add(this.domNode, 'has-empty');

            this._processData(items);

            domClass.remove(this.domNode, 'is-loading');

            /* remove the loading indicator so that it does not get re-shown while requesting more data */
            if (start === 0) domConstruct.destroy(this.loadingIndicatorNode);

            this.onContentChange();
            connect.publish('/app/toolbar/update', []);
        },
<span id='argos-List-method-_onQueryTotal'>        _onQueryTotal: function(size) {
</span>            if (size === 0)
            {
                domConstruct.place(this.noDataTemplate.apply(this), this.contentNode, 'only');
            }
            else
            {
                var remaining = size &gt; -1
                    ? size - (this.position + this.pageSize)
                    : -1;

                if (remaining !== -1)
                    this.set('remainingContent', string.substitute(this.remainingText, [remaining]));

                domClass.toggle(this.domNode, 'has-more', (remaining === -1 || remaining &gt; 0));

                this.position = this.position + this.pageSize;
            }
        },
<span id='argos-List-method-_onQueryError'>        _onQueryError: function(queryOptions, error) {
</span>            if (error.aborted)
            {
                this.options = false; // force a refresh
            }
            else
            {
                alert(string.substitute(this.requestErrorText, [error]));
            }

            var errorItem = {
                viewOptions: this.options,
                serverError: error
            };
            ErrorManager.addError(this.requestErrorText, errorItem);

            domClass.remove(this.domNode, 'is-loading');
        },
<span id='argos-List-method-_requestData'>        _requestData: function() {
</span>            domClass.add(this.domNode, 'is-loading');

            var store = this.get('store'),
                queryOptions = {
                    count: this.pageSize,
                    start: this.position
                };

            this._applyStateToQueryOptions(queryOptions);

            var queryExpression = this._buildQueryExpression() || null,
                queryResults = store.query(queryExpression, queryOptions);

            Deferred.when(queryResults,
                lang.hitch(this, this._onQueryComplete, queryResults),
                lang.hitch(this, this._onQueryError, queryOptions)
            );

            return queryResults;
        },
<span id='argos-List-method-_buildQueryExpression'>        _buildQueryExpression: function() {
</span>            return lang.mixin(this.query || {}, this.options.query || this.options.where);
        },
<span id='argos-List-method-_applyStateToQueryOptions'>        _applyStateToQueryOptions: function(queryOptions) {
</span>
        },
<span id='argos-List-method-emptySelection'>        /**
</span>         * Handler for the none/no selection button is pressed. Used in selection views when not selecting is an option.
         * Invokes the `this.options.singleSelectAction` tool.
         */
        emptySelection: function() {
            /// &lt;summary&gt;
            ///     Called when the emptySelection/None button is clicked.
            /// &lt;/summary&gt;
            this._selectionModel.clear();

            topic.publish('/app/toolbar/invoke', this.options.singleSelectAction);
        },
<span id='argos-List-method-refreshRequiredFor'>        /**
</span>         * Determines if the view should be refresh by inspecting and comparing the passed navigation options with current values.
         * @param {Object} options Passed navigation options.
         * @return {Boolean} True if the view should be refreshed, false if not.
         */
        refreshRequiredFor: function(options) {
            if (this.options)
            {
                if (options)
                {
                    if (this.expandExpression(this.options.where) != this.expandExpression(options.where)) return true;
                    if (this.expandExpression(this.options.query) != this.expandExpression(options.query)) return true;
                    if (this.expandExpression(this.options.resourceKind) != this.expandExpression(options.resourceKind)) return true;
                    if (this.expandExpression(this.options.resourcePredicate) != this.expandExpression(options.resourcePredicate)) return true;
                }

                return false;
            }
            else
                return this.inherited(arguments);
        },
<span id='argos-List-method-getContext'>        /**
</span>         * Returns the current views context by expanding upon the {@link View#getContext parent implementation} to include
         * the views resourceKind.
         * @return {Object} context.
         */
        getContext: function() {
            return lang.mixin(this.inherited(arguments), {
                resourceKind: this.resourceKind
            });
        },
<span id='argos-List-method-beforeTransitionTo'>        /**
</span>         * Extends the {@link View#beforeTransitionTo parent implementation} by also toggling the visibility of the views
         * components and clearing the view and selection model as needed.
         */
        beforeTransitionTo: function() {
            this.inherited(arguments);

            domClass.toggle(this.domNode, 'has-search-header', !this.hideSearch);
            domClass.toggle(this.domNode, 'has-selectors', !this.isSelectionDisabled());

            if (this._selectionModel &amp;&amp; !this.isSelectionDisabled())
                this._selectionModel.useSingleSelection(this.options.singleSelect);

            if (typeof this.options.enableActions !== 'undefined')
                this.enableActions = this.options.enableActions;

            domClass.toggle(this.domNode, 'list-show-actions', this.enableActions);
            if (this.enableActions)
            {
                this._selectionModel.useSingleSelection(true);
            }

            if (this.refreshRequired)
            {
                this.clear();
            }
            else
            {
                // if enabled, clear any pre-existing selections
                if (this._selectionModel &amp;&amp; this.autoClearSelection &amp;&amp; !this.enableActions)
                    this._selectionModel.clear();
            }
        },
<span id='argos-List-method-transitionTo'>        /**
</span>         * Extends the {@link View#transitionTo parent implementation} to also configure the search widget and
         * load previous selections into the selection model.
         */
        transitionTo: function() {
            if (this._selectionModel) this._loadPreviousSelections();

            this.inherited(arguments);
        },
<span id='argos-List-method-load'>        load: function() {
</span>            this.inherited(arguments);

            this._requestData();
        },
<span id='argos-List-method-more'>        more: function() {
</span>            this._requestData();
        },
<span id='argos-List-method-clear'>        /**
</span>         * Clears the view by:
         *
         *  * clearing the selection model, but without it invoking the event handlers;
         *  * clears the views data such as `this.entries` and `this.feed`;
         *  * clears the search width if passed true; and
         *  * applies the default template.
         *
         * @param {Boolean} all If true, also clear the search widget.
         */
        clear: function(all) {
            if (this._selectionModel)
            {
                this._selectionModel.suspendEvents();
                this._selectionModel.clear();
                this._selectionModel.resumeEvents();
            }

            this.items = {};
            this.position = 0;

            if (all !== false)
            {
                this.query = false;

                this.$.search.clear();
            }

            domClass.remove(this.domNode, 'has-more');

            this.loadingIndicatorNode = domConstruct.place(this.loadingTemplate.apply(this), this.contentNode, 'only');

            domClass.add(this.domNode, 'is-loading');
        }
    });
});
</pre>
</body>
</html>
