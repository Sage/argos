<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">/* Copyright (c) 2010, Sage Software, Inc. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

<span id='Sage-Platform-Mobile-_ActionMixin'>/**
</span> *
 * @alternateClassName _ActionMixin
 */
define('Sage/Platform/Mobile/_ActionMixin', [
    'dojo/_base/array',
    'dojo/_base/declare',
    'dojo/_base/event',
    'dojo/dom-attr',
    'dojo/query',
    'dojo/NodeList-traverse'
], function(
    array,
    declare,
    event,
    domAttr,
    query
) {

    return declare('Sage.Platform.Mobile._ActionMixin', null, {
<span id='Sage-Platform-Mobile-_ActionMixin-property-actionsFrom'>        actionsFrom: 'click',
</span><span id='Sage-Platform-Mobile-_ActionMixin-method-postCreate'>        postCreate: function() {
</span>            // todo: add delegation
            array.forEach(this.actionsFrom.split(','), function(event) {
                this.connect(this.domNode, event, this._initiateActionFromEvent);
            }, this);
        },
<span id='Sage-Platform-Mobile-_ActionMixin-method-_isValidElementForAction'>        _isValidElementForAction: function(el) {
</span>            var contained = this.domNode.contains
                ? this.domNode != el &amp;&amp; this.domNode.contains(el)
                : !!(this.domNode.compareDocumentPosition(el) &amp; 16);

            return (this.domNode === el) || contained;
        },
<span id='Sage-Platform-Mobile-_ActionMixin-method-_initiateActionFromEvent'>        _initiateActionFromEvent: function(evt) {
</span>            var el = query(evt.target).closest('[data-action]')[0],
                action = el &amp;&amp; domAttr.get(el, 'data-action');

            if (action &amp;&amp; this._isValidElementForAction(el) &amp;&amp; this.hasAction(action, evt, el))
            {
                var parameters = this._getParametersForAction(action, evt, el);

                this.invokeAction(action, parameters, evt, el);

                event.stop(evt);
            }
        },
<span id='Sage-Platform-Mobile-_ActionMixin-method-_getParametersForAction'>        _getParametersForAction: function(name, evt, el) {
</span>            var parameters = {
                $event: evt,
                $source: el
            };

            for (var i = 0, attrLen = el.attributes.length; i &lt; attrLen; i++)
            {
                var attributeName = el.attributes[i].name;
                if (/^((?=data-action)|(?!data))/.test(attributeName)) continue;

                /* transform hyphenated names to pascal case, minus the data segment, to be in line with HTML5 dataset naming conventions */
                /* see: http://dev.w3.org/html5/spec/elements.html#embedding-custom-non-visible-data */
                /* todo: remove transformation and use dataset when browser support is there */
                var parameterName = attributeName.substr('data-'.length).replace(/-(\w)(\w+)/g, function($0, $1, $2) { return $1.toUpperCase() + $2; });

                parameters[parameterName] = domAttr.get(el, attributeName);
            }

            return parameters;
        },
<span id='Sage-Platform-Mobile-_ActionMixin-method-hasAction'>        hasAction: function(name, evt, el) {
</span>            return (typeof this[name] === 'function');
        },
<span id='Sage-Platform-Mobile-_ActionMixin-method-invokeAction'>        invokeAction: function(name, parameters, evt, el) {
</span>            return this[name].apply(this, [parameters, evt, el]);
        }
    });

});
</pre>
</body>
</html>
